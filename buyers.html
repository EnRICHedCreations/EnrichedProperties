<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Buy Boxes - Enriched Property Solutions | Wholesale to Cash Buyers</title>
    <meta name="description" content="Browse active buy boxes from verified cash buyers seeking wholesale properties. Submit your deals directly to matched investors with specific criteria and budgets.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        .font-inter { font-family: 'Inter', sans-serif; }
        .font-playfair { font-family: 'Playfair Display', serif; }
        
        .text-shadow-luxury {
            text-shadow: 0 4px 20px rgba(15, 23, 42, 0.4), 0 2px 8px rgba(15, 23, 42, 0.3);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #1d4ed8 100%);
        }
        
        .gradient-accent {
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #22c55e 100%);
        }
        
        .gradient-dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15), 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-15px) rotate(1deg); }
            66% { transform: translateY(-5px) rotate(-1deg); }
        }
        
        .premium-border {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box, linear-gradient(135deg, #3b82f6, #1e40af) border-box;
        }
        
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes pulseGlow {
            from {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            }
            to {
                box-shadow: 0 0 40px rgba(59, 130, 246, 0.8), 0 0 60px rgba(59, 130, 246, 0.4);
            }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pattern-overlay {
            background-image: radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                             radial-gradient(circle at 75% 75%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
        }

        /* Search and Filter Styles */
        .filter-badge {
            @apply inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 cursor-pointer transition-colors;
        }
        .filter-badge.active {
            @apply bg-blue-600 text-white;
        }
        .filter-badge:hover {
            @apply bg-blue-200;
        }
        .filter-badge.active:hover {
            @apply bg-blue-700;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark': '#0f172a',
                        'brand-dark-light': '#1e293b', 
                        'brand-primary': '#3b82f6',
                        'brand-primary-dark': '#1e40af',
                        'brand-accent': '#10b981',
                        'brand-accent-light': '#22c55e',
                        'brand-light': '#f8fafc',
                        'brand-cream': '#fefefe',
                        'brand-gray': '#f1f5f9'
                    }
                }
            }
        }
    </script>
</head>

<body class="font-inter bg-brand-light">
    <!-- Navigation -->
    <nav class="bg-white/95 backdrop-blur-sm shadow-lg fixed w-full transition-all duration-300" style="z-index: 50;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between min-h-16 sm:h-20 items-center py-2">
                <div class="flex-shrink-0">
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <div class="w-10 h-10 sm:w-14 sm:h-14 gradient-primary rounded-2xl flex items-center justify-center shadow-xl pulse-glow flex-shrink-0">
                            <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                        </div>
                        <div class="min-w-0">
                            <a href="index.html">
                                <h1 class="font-playfair text-base sm:text-2xl lg:text-3xl font-bold gradient-text leading-tight">
                                    Enriched Property Solutions
                                </h1>
                                <p class="text-xs text-brand-primary uppercase tracking-wider font-semibold hidden sm:block">Premium Cash Buyers</p>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="hidden lg:flex space-x-6 items-center">
                    <a href="index.html#services" class="text-gray-700 hover:text-brand-primary transition-all duration-300 font-semibold text-base relative group">
                        How It Works
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-primary transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="index.html#about" class="text-gray-700 hover:text-brand-primary transition-all duration-300 font-semibold text-base relative group">
                        Why Choose Us?
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-primary transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="index.html#contact" class="text-gray-700 hover:text-brand-primary transition-all duration-300 font-semibold text-base relative group">
                        Get My Offer
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-primary transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="buyers.html" class="text-brand-primary hover:text-brand-primary-dark transition-all duration-300 font-semibold text-base relative group">
                        Buy Boxes
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-primary-dark transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </div>
                
                <div class="lg:hidden flex items-center">
                    <button id="mobile-menu-button" class="text-gray-700 p-3 rounded-xl hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-brand-primary flex-shrink-0" style="pointer-events: auto !important;">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="lg:hidden hidden bg-white/95 backdrop-blur-sm shadow-lg border-t" style="z-index: 40;">
            <div class="px-4 py-4 space-y-1 max-h-screen overflow-y-auto">
                <a href="index.html#services" class="block text-gray-700 hover:text-brand-primary hover:bg-gray-50 transition-colors font-semibold py-3 px-2 rounded-lg">How It Works</a>
                <a href="index.html#about" class="block text-gray-700 hover:text-brand-primary hover:bg-gray-50 transition-colors font-semibold py-3 px-2 rounded-lg">Why Choose Us?</a>
                <a href="index.html#contact" class="block text-gray-700 hover:text-brand-primary hover:bg-gray-50 transition-colors font-semibold py-3 px-2 rounded-lg">Get My Offer</a>
                <a href="buyers.html" class="block text-brand-primary hover:text-brand-primary-dark hover:bg-blue-50 transition-colors font-semibold py-3 px-2 rounded-lg">Buy Boxes</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative pt-20 sm:pt-32 pb-16 bg-gradient-to-br from-indigo-50 via-white to-blue-50/30 overflow-hidden">
        <div class="absolute inset-0">
            <div class="absolute top-1/3 left-0 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl -translate-x-48"></div>
            <div class="absolute bottom-1/3 right-0 w-96 h-96 bg-indigo-500/5 rounded-full blur-3xl translate-x-48"></div>
        </div>
        
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="mb-12">
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-playfair font-bold text-brand-dark mb-8 leading-tight text-shadow-luxury">
                    Active <span class="gradient-text">Buy Boxes</span>
                </h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
                    Connect your wholesale properties with serious, vetted investors actively seeking deals in specific markets and price ranges
                </p>
            </div>

            <!-- Search and Filter Section -->
            <div class="max-w-4xl mx-auto mb-12">
                <div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Search Location</label>
                            <input type="text" id="locationSearch" placeholder="State, City, or Zip"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                                   onkeyup="filterBuyBoxes()">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Price Range</label>
                            <select id="priceRangeFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                                    onchange="filterBuyBoxes()">
                                <option value="">All Price Ranges</option>
                                <option value="0-100000">Under $100K</option>
                                <option value="100000-250000">$100K - $250K</option>
                                <option value="250000-500000">$250K - $500K</option>
                                <option value="500000-1000000">$500K - $1M</option>
                                <option value="1000000+">Over $1M</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Property Type</label>
                            <select id="propertyTypeFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                                    onchange="filterBuyBoxes()">
                                <option value="">All Property Types</option>
                                <option value="Single Family">Single Family</option>
                                <option value="Condo">Condo</option>
                                <option value="Townhouse">Townhouse</option>
                                <option value="Multi-Family">Multi-Family</option>
                                <option value="Land">Land/Lots</option>
                                <option value="Commercial">Commercial</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Filters Row -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Min Bedrooms</label>
                            <select id="bedroomFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                                    onchange="filterBuyBoxes()">
                                <option value="">Any Bedrooms</option>
                                <option value="1">1+</option>
                                <option value="2">2+</option>
                                <option value="3">3+</option>
                                <option value="4">4+</option>
                                <option value="5">5+</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Min Bathrooms</label>
                            <select id="bathroomFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                                    onchange="filterBuyBoxes()">
                                <option value="">Any Bathrooms</option>
                                <option value="1">1+</option>
                                <option value="1.5">1.5+</option>
                                <option value="2">2+</option>
                                <option value="2.5">2.5+</option>
                                <option value="3">3+</option>
                                <option value="3.5">3.5+</option>
                                <option value="4">4+</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Min Square Feet</label>
                            <input type="number" id="squareFeetFilter" placeholder="Min sq ft"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                                   onkeyup="filterBuyBoxes()" min="0">
                        </div>
                    </div>
                    
                    <!-- Buyer Type Filter Badges -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <span class="text-sm font-semibold text-gray-700 mr-2">Buyer Types:</span>
                        <span class="filter-badge active" data-type="all" onclick="filterByBuyerType('all')">All Buyers</span>
                        <span class="filter-badge" data-type="hedge-fund" onclick="filterByBuyerType('hedge-fund')">Hedge Funds</span>
                        <span class="filter-badge" data-type="private-investor" onclick="filterByBuyerType('private-investor')">Private Investors</span>
                        <span class="filter-badge" data-type="fix-flip" onclick="filterByBuyerType('fix-flip')">Fix & Flip</span>
                        <span class="filter-badge" data-type="buy-hold" onclick="filterByBuyerType('buy-hold')">Buy & Hold</span>
                        <span class="filter-badge" data-type="wholesaler" onclick="filterByBuyerType('wholesaler')">Wholesalers</span>
                    </div>

                    <div class="flex justify-between items-center">
                        <button onclick="clearFilters()" class="text-brand-primary hover:text-brand-primary-dark font-semibold">
                            Clear All Filters
                        </button>
                        <div class="text-sm text-gray-600">
                            Showing <span id="resultCount">0</span> active buy boxes
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-3xl p-12 shadow-lg border border-gray-100">
                    <h2 class="text-3xl font-playfair font-bold text-brand-dark mb-4">
                        Have a Property That Matches?
                    </h2>
                    <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
                        Submit your wholesale deal and we'll instantly match it with qualified buyers from our network
                    </p>
                    <button onclick="openSubmitDealModal()" class="gradient-primary text-white px-12 py-4 rounded-xl text-xl font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 pulse-glow">
                        Submit Your Deal
                    </button>
                </div>
            </div>

            <!-- Buy Boxes Grid -->
            <div id="buy-boxes-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Buy boxes will be loaded here dynamically -->
                <div class="text-center py-12 col-span-full">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading active buy boxes...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Submit Deal Modal -->
    <div id="submitDealModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 m-4 w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-brand-dark">Submit Your Deal</h3>
                <button onclick="closeSubmitDealModal()" class="text-gray-400 hover:text-gray-600 text-2xl font-light">&times;</button>
            </div>
            <form id="submitDealForm">
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="dealStreetAddress" class="block text-gray-700 text-sm font-semibold mb-2">Street Address*</label>
                            <input type="text" id="dealStreetAddress" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="123 Main St" required>
                        </div>
                        <div>
                            <label for="dealCity" class="block text-gray-700 text-sm font-semibold mb-2">City*</label>
                            <input type="text" id="dealCity" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="Albany" required>
                        </div>
                        <div>
                            <label for="dealState" class="block text-gray-700 text-sm font-semibold mb-2">State*</label>
                            <input type="text" id="dealState" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="NY" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
                        <div>
                            <label for="dealPrice" class="block text-gray-700 text-sm font-semibold mb-2">Asking Price*</label>
                            <input type="number" id="dealPrice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="250000" min="0" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="dealBedrooms" class="block text-gray-700 text-sm font-semibold mb-2">Bedrooms*</label>
                            <select id="dealBedrooms" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" required>
                                <option value="">Select</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5+</option>
                            </select>
                        </div>
                        <div>
                            <label for="dealBathrooms" class="block text-gray-700 text-sm font-semibold mb-2">Bathrooms*</label>
                            <select id="dealBathrooms" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" required>
                                <option value="">Select</option>
                                <option value="1">1</option>
                                <option value="1.5">1.5</option>
                                <option value="2">2</option>
                                <option value="2.5">2.5</option>
                                <option value="3">3</option>
                                <option value="3.5">3.5</option>
                                <option value="4">4+</option>
                            </select>
                        </div>
                        <div>
                            <label for="dealSquareFeet" class="block text-gray-700 text-sm font-semibold mb-2">Square Feet</label>
                            <input type="number" id="dealSquareFeet" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="1500" min="0">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="dealPropertyType" class="block text-gray-700 text-sm font-semibold mb-2">Property Type*</label>
                            <select id="dealPropertyType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" required>
                                <option value="">Select</option>
                                <option value="Single Family">Single Family</option>
                                <option value="Condo">Condo</option>
                                <option value="Townhouse">Townhouse</option>
                                <option value="Multi-Family">Multi-Family</option>
                                <option value="Land">Land</option>
                                <option value="Commercial">Commercial</option>
                            </select>
                        </div>
                        <div>
                            <label for="dealCondition" class="block text-gray-700 text-sm font-semibold mb-2">Condition*</label>
                            <select id="dealCondition" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" required>
                                <option value="">Select</option>
                                <option value="Excellent">Excellent</option>
                                <option value="Good">Good</option>
                                <option value="Fair">Fair</option>
                                <option value="Needs Work">Needs Work</option>
                                <option value="Tear Down">Tear Down</option>
                            </select>
                        </div>
                    </div>

                    <!-- Deal Analysis Fields -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="dealARV" class="block text-gray-700 text-sm font-semibold mb-2">Estimated ARV*</label>
                            <input type="number" id="dealARV" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="350000" min="0" required>
                            <p class="text-xs text-gray-500 mt-1">After Repair Value - what the property will be worth after repairs</p>
                        </div>
                        <div>
                            <label for="dealRepairCosts" class="block text-gray-700 text-sm font-semibold mb-2">Estimated Repair Costs*</label>
                            <input type="number" id="dealRepairCosts" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="25000" min="0" required>
                            <p class="text-xs text-gray-500 mt-1">Total estimated cost for all necessary repairs</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="dealContractedPrice" class="block text-gray-700 text-sm font-semibold mb-2">Contracted Price*</label>
                            <input type="number" id="dealContractedPrice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="275000" min="0" required>
                            <p class="text-xs text-gray-500 mt-1">Your contracted purchase price with the seller</p>
                        </div>
                        <div>
                            <label for="dealClosingDate" class="block text-gray-700 text-sm font-semibold mb-2">Closing Date*</label>
                            <input type="date" id="dealClosingDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" required>
                            <p class="text-xs text-gray-500 mt-1">When you need to close with the seller</p>
                        </div>
                    </div>

                    <div>
                        <label for="dealDescription" class="block text-gray-700 text-sm font-semibold mb-2">Property Description</label>
                        <textarea id="dealDescription" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="Describe the property features, condition, and any special details..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="wholesalerName" class="block text-gray-700 text-sm font-semibold mb-2">Your Name*</label>
                            <input type="text" id="wholesalerName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="John Smith" required>
                        </div>
                        <div>
                            <label for="wholesalerPhone" class="block text-gray-700 text-sm font-semibold mb-2">Phone Number*</label>
                            <input type="tel" id="wholesalerPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="(555) 123-4567" required>
                        </div>
                    </div>
                    <div>
                        <label for="wholesalerEmail" class="block text-gray-700 text-sm font-semibold mb-2">Email Address*</label>
                        <input type="email" id="wholesalerEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent" placeholder="john@example.com" required>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-900 mb-2">Matching Buy Boxes</h4>
                        <div id="matchingBuyBoxes" class="text-sm text-gray-600">
                            Enter property details above to see matching buyers...
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-brand-primary text-white py-4 rounded-lg text-lg font-semibold hover:bg-blue-800 transition-colors">
                        Submit Deal to Matching Buyers
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 m-4 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-brand-dark">Dashboard Login</h3>
                <button onclick="hideLoginModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            <form onsubmit="login(event)">
                <div class="space-y-4">
                    <div>
                        <label for="username" class="block text-gray-700 text-sm font-semibold mb-2">Username</label>
                        <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="admin" required>
                    </div>
                    <div>
                        <label for="password" class="block text-gray-700 text-sm font-semibold mb-2">Password</label>
                        <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="enriched2024" required>
                    </div>
                    <button type="submit" class="w-full bg-brand-primary text-white py-3 rounded-lg font-semibold hover:bg-blue-800">
                        Login to Dashboard
                    </button>
                </div>
            </form>
            <p class="text-center text-sm text-gray-600 mt-4">
                Demo credentials: admin / enriched2024
            </p>
        </div>
    </div>

    <!-- Firebase SDK v8 for compatibility -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/main.js"></script>

    <script>
        // Global variables for filtering
        let allBuyBoxes = [];
        let filteredBuyBoxes = [];
        let currentBuyerTypeFilter = 'all';

        // Mobile menu toggle - fixed version from index.html
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            console.log('Mobile menu elements:', mobileMenuButton, mobileMenu);

            if (mobileMenuButton && mobileMenu) {
                let clickCount = 0;

                // Simple toggle function with detailed logging
                mobileMenuButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    clickCount++;
                    console.log('Menu button clicked #' + clickCount);
                    console.log('Button element:', e.target);
                    console.log('Button computed style:', window.getComputedStyle(mobileMenuButton).pointerEvents);
                    console.log('Menu currently has classes:', mobileMenu.className);
                    console.log('Menu is hidden?', mobileMenu.classList.contains('hidden'));

                    mobileMenu.classList.toggle('hidden');

                    // Force pointer events to stay enabled
                    mobileMenuButton.style.pointerEvents = 'auto';

                    console.log('After toggle - Menu classes:', mobileMenu.className);
                    console.log('After toggle - Menu is hidden?', mobileMenu.classList.contains('hidden'));

                    // Force a small delay to see if timing is an issue
                    setTimeout(() => {
                        console.log('Button still exists?', document.getElementById('mobile-menu-button'));
                        // Ensure pointer events are still enabled
                        mobileMenuButton.style.pointerEvents = 'auto';
                    }, 100);
                });

                // Close menu when clicking on menu items
                const menuLinks = mobileMenu.querySelectorAll('a');
                console.log('Found menu links:', menuLinks.length);

                menuLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        console.log('Menu link clicked'); // Debug log
                        mobileMenu.classList.add('hidden');
                    });
                });
            }

            // Load buy boxes on page load
            loadBuyBoxes();

            // Set up deal form event listeners
            setupDealFormListeners();
        });

        // Buy Boxes functionality
        async function loadBuyBoxes() {
            const grid = document.getElementById('buy-boxes-grid');
            if (!grid) return;

            try {
                // Show loading state
                grid.innerHTML = `
                    <div class="text-center py-12 col-span-full">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">Loading active buy boxes...</p>
                    </div>
                `;

                // Load buyers from Firebase using CloudStorage
                const buyers = await CloudStorage.loadData('Buyers', []);
                allBuyBoxes = buyers;
                filteredBuyBoxes = [...buyers];
                
                if (buyers.length === 0) {
                    grid.innerHTML = `
                        <div class="text-center py-12 col-span-full">
                            <div class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                            </div>
                            <p class="text-gray-600">No active buy boxes available</p>
                            <p class="text-sm text-gray-500 mt-2">Check back soon for new investor opportunities</p>
                        </div>
                    `;
                    updateResultCount(0);
                    return;
                }

                // Display buy boxes and update count
                displayBuyBoxes(filteredBuyBoxes);
                updateResultCount(filteredBuyBoxes.length);

            } catch (error) {
                console.error('Error loading buy boxes:', error);
                grid.innerHTML = `
                    <div class="text-center py-12 col-span-full">
                        <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.864-.833-2.634 0L4.168 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <p class="text-gray-600">Unable to load buy boxes</p>
                        <p class="text-sm text-gray-500 mt-2">Please try again later</p>
                    </div>
                `;
                updateResultCount(0);
            }
        }

        function displayBuyBoxes(buyBoxesToDisplay) {
            const grid = document.getElementById('buy-boxes-grid');
            if (!grid) return;

            // Create buy box cards (show only criteria, not buyer personal info)
            const buyBoxCards = buyBoxesToDisplay.map(buyer => createBuyBoxCard(buyer)).join('');
            grid.innerHTML = buyBoxCards;
        }

        function createBuyBoxCard(buyer) {
            // Map dashboard buyer type to display strategy
            const strategyMap = {
                'hedge-fund': 'Hedge Fund',
                'private-investor': 'Private Investor', 
                'fix-flip': 'Fix & Flip',
                'buy-hold': 'Buy & Hold',
                'wholesaler': 'Wholesaler',
                'other': 'Investment'
            };
            const strategy = strategyMap[buyer.type] || buyer.strategy || 'Investment';
            
            const strategyColors = {
                'Hedge Fund': 'from-blue-500 to-indigo-600',
                'Private Investor': 'from-green-500 to-emerald-600',
                'Fix & Flip': 'from-orange-500 to-red-600',
                'Buy & Hold': 'from-green-500 to-emerald-600',
                'Wholesaler': 'from-purple-500 to-violet-600',
                'Investment': 'from-gray-500 to-slate-600'
            };
            const gradientColor = strategyColors[strategy] || strategyColors['Investment'];

            // Build location display - prioritize combined areas, then individual fields
            let locationDisplay = 'Nationwide';
            if (buyer.areas) {
                // Check if areas already in proper format, if not reformat
                if (buyer.areas.includes(',') && buyer.state && buyer.cities) {
                    // If we have both state and cities, format as "Cities, State"
                    locationDisplay = buyer.cities + ', ' + buyer.state;
                } else {
                    locationDisplay = buyer.areas;
                }
            } else if (buyer.preferredAreas) {
                locationDisplay = buyer.preferredAreas;
            } else if (buyer.state) {
                if (buyer.cities) {
                    locationDisplay = buyer.cities + ', ' + buyer.state;
                } else {
                    locationDisplay = buyer.state;
                }
            }

            return `
                <div class="group bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100 hover:border-blue-200 overflow-hidden hover-lift">
                    <!-- Header with strategy -->
                    <div class="bg-gradient-to-r ${gradientColor} p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-bold text-white text-lg">${strategy}</h3>
                                    <p class="text-white/80 text-sm">Active Buyer</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-white/80 text-xs">Box ID</div>
                                <div class="text-white font-mono text-sm">#${buyer.id || 'N/A'}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Buy box criteria -->
                    <div class="p-6 space-y-4">
                        <!-- Location -->
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">Target Markets</div>
                                <div class="text-gray-600">${locationDisplay}</div>
                            </div>
                        </div>

                        <!-- Price Range -->
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">Price Range</div>
                                <div class="text-gray-600">$${buyer.minBudget ? parseInt(buyer.minBudget).toLocaleString() : '0'} - $${buyer.maxBudget ? parseInt(buyer.maxBudget).toLocaleString() : '∞'}</div>
                            </div>
                        </div>

                        <!-- Property Type -->
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">Property Types</div>
                                <div class="text-gray-600">${buyer.propertyTypes || buyer.propertyType || 'All Types'}</div>
                            </div>
                        </div>

                        <!-- Property Requirements -->
                        ${(buyer.minBedrooms || buyer.minBathrooms || buyer.minSquareFeet) ? `
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0h2m-2 0v1a2 2 0 002 2h6a2 2 0 002-2V7a2 2 0 00-2-2h-6a2 2 0 00-2 2v1"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">Minimum Requirements</div>
                                <div class="text-gray-600 text-sm">
                                    ${buyer.minBedrooms ? `${buyer.minBedrooms}+ BR` : ''}
                                    ${buyer.minBedrooms && buyer.minBathrooms ? ' • ' : ''}
                                    ${buyer.minBathrooms ? `${buyer.minBathrooms}+ BA` : ''}
                                    ${(buyer.minBedrooms || buyer.minBathrooms) && buyer.minSquareFeet ? ' • ' : ''}
                                    ${buyer.minSquareFeet ? `${parseInt(buyer.minSquareFeet).toLocaleString()}+ sqft` : ''}
                                </div>
                            </div>
                        </div>
                        ` : ''}

                        <!-- Special Notes -->
                        ${buyer.notes ? `
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <div class="font-semibold text-gray-900 text-sm mb-1">Buying Criteria</div>
                            <div class="text-gray-600 text-sm">${buyer.notes}</div>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Footer -->
                    <div class="px-6 pb-6">
                        <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                            <div class="text-sm text-gray-500">
                                Added ${buyer.dateAdded ? new Date(buyer.dateAdded).toLocaleDateString() : 'N/A'}
                            </div>
                            <div class="flex items-center text-green-600 text-sm font-medium">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                ${buyer.status === 'active' ? 'Active' : buyer.status || 'Active'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Search and Filter Functions
        function filterBuyBoxes() {
            const locationSearch = document.getElementById('locationSearch').value.toLowerCase();
            const priceRange = document.getElementById('priceRangeFilter').value;
            const propertyType = document.getElementById('propertyTypeFilter').value;
            const bedroomFilter = document.getElementById('bedroomFilter').value;
            const bathroomFilter = document.getElementById('bathroomFilter').value;
            const squareFeetFilter = parseInt(document.getElementById('squareFeetFilter').value) || 0;

            console.log('Filtering with:', { locationSearch, priceRange, propertyType, bedroomFilter, bathroomFilter, squareFeetFilter, currentBuyerTypeFilter });
            console.log('All buyers:', allBuyBoxes);

            filteredBuyBoxes = allBuyBoxes.filter(buyer => {
                // Location filter - check multiple location fields
                if (locationSearch) {
                    const locationMatched = [
                        buyer.areas,
                        buyer.preferredAreas, 
                        buyer.state,
                        buyer.cities
                    ].some(field => field && field.toLowerCase().includes(locationSearch));
                    
                    if (!locationMatched) {
                        return false;
                    }
                }

                // Price range filter
                if (priceRange) {
                    const [min, max] = priceRange.includes('+') ? [parseInt(priceRange.split('+')[0]), Infinity] : priceRange.split('-').map(Number);
                    const buyerMin = buyer.minBudget || 0;
                    const buyerMax = buyer.maxBudget || Infinity;
                    
                    // Check if there's overlap between the filter range and buyer's range
                    if (buyerMax < min || buyerMin > max) {
                        return false;
                    }
                }

                // Property type filter - check if buyer accepts this property type
                if (propertyType && buyer.propertyTypes) {
                    const buyerTypes = buyer.propertyTypes.toLowerCase();
                    const searchType = propertyType.toLowerCase();
                    
                    // Check for exact match or common variations
                    if (!buyerTypes.includes(searchType)) {
                        // Check for common variations
                        const typeVariations = {
                            'single family': ['sfh', 'single-family', 'house', 'homes'],
                            'multi-family': ['multifamily', 'duplex', 'triplex', 'fourplex', 'multi family'],
                            'condo': ['condos', 'condominium'],
                            'townhouse': ['townhome', 'town house'],
                            'commercial': ['retail', 'office', 'warehouse'],
                            'land': ['lots', 'vacant']
                        };
                        
                        const variations = typeVariations[searchType] || [];
                        const hasVariation = variations.some(variation => buyerTypes.includes(variation));
                        
                        if (!hasVariation) {
                            return false;
                        }
                    }
                }

                // Bedroom filter - check if buyer accepts the minimum bedroom count
                if (bedroomFilter && buyer.minBedrooms) {
                    const filterBedrooms = parseInt(bedroomFilter);
                    const buyerMinBedrooms = parseInt(buyer.minBedrooms);
                    if (filterBedrooms < buyerMinBedrooms) {
                        return false;
                    }
                }

                // Bathroom filter - check if buyer accepts the minimum bathroom count
                if (bathroomFilter && buyer.minBathrooms) {
                    const filterBathrooms = parseFloat(bathroomFilter);
                    const buyerMinBathrooms = parseFloat(buyer.minBathrooms);
                    if (filterBathrooms < buyerMinBathrooms) {
                        return false;
                    }
                }

                // Square footage filter - check if buyer accepts the minimum square footage
                if (squareFeetFilter && buyer.minSquareFeet) {
                    const buyerMinSquareFeet = parseInt(buyer.minSquareFeet);
                    if (squareFeetFilter < buyerMinSquareFeet) {
                        return false;
                    }
                }

                // Buyer type filter
                if (currentBuyerTypeFilter !== 'all') {
                    if (buyer.type !== currentBuyerTypeFilter) {
                        return false;
                    }
                }

                return true;
            });

            console.log('Filtered results:', filteredBuyBoxes.length);
            displayBuyBoxes(filteredBuyBoxes);
            updateResultCount(filteredBuyBoxes.length);
        }

        function filterByBuyerType(buyerType) {
            currentBuyerTypeFilter = buyerType;

            // Update active badge
            document.querySelectorAll('.filter-badge').forEach(badge => {
                badge.classList.remove('active');
            });
            document.querySelector(`[data-type="${buyerType}"]`).classList.add('active');

            // Apply all filters
            filterBuyBoxes();
        }

        function clearFilters() {
            document.getElementById('locationSearch').value = '';
            document.getElementById('priceRangeFilter').value = '';
            document.getElementById('propertyTypeFilter').value = '';
            document.getElementById('bedroomFilter').value = '';
            document.getElementById('bathroomFilter').value = '';
            document.getElementById('squareFeetFilter').value = '';

            // Reset buyer type filter
            filterByBuyerType('all');
        }

        function updateResultCount(count) {
            const resultCountElement = document.getElementById('resultCount');
            if (resultCountElement) {
                resultCountElement.textContent = count;
            }
        }

        // Submit Deal Modal Functions
        function openSubmitDealModal() {
            const modal = document.getElementById('submitDealModal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // Focus on property address field
                setTimeout(() => {
                    const addressField = document.getElementById('dealPropertyAddress');
                    if (addressField) {
                        addressField.focus();
                    }
                }, 100);
            }
        }

        function closeSubmitDealModal() {
            const modal = document.getElementById('submitDealModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                // Clear form
                const form = modal.querySelector('form');
                if (form) {
                    form.reset();
                    document.getElementById('matchingBuyBoxes').innerHTML = 'Enter property details above to see matching buyers...';
                }
            }
        }

        function setupDealFormListeners() {
            const form = document.getElementById('submitDealForm');
            const phoneInput = document.getElementById('wholesalerPhone');
            
            // Phone formatting
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    const formatted = EnrichedProps.formatPhoneNumber(e.target.value);
                    e.target.value = formatted;
                });
            }

            // Form submission
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleDealSubmission(this);
                });

                // Update matching buy boxes as user types
                const watchFields = ['dealStreetAddress', 'dealCity', 'dealState', 'dealPrice', 'dealBedrooms', 'dealBathrooms', 'dealSquareFeet', 'dealPropertyType', 'dealCondition', 'dealARV', 'dealRepairCosts', 'dealContractedPrice', 'dealClosingDate'];
                watchFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', updateMatchingBuyBoxes);
                        field.addEventListener('change', updateMatchingBuyBoxes);
                    }
                });
            }
        }

        async function updateMatchingBuyBoxes() {
            const streetAddress = document.getElementById('dealStreetAddress').value;
            const city = document.getElementById('dealCity').value;
            const state = document.getElementById('dealState').value;

            // Create combined address for compatibility
            const fullAddress = [streetAddress, city, state].filter(part => part.trim()).join(', ');

            const dealData = {
                address: fullAddress,
                streetAddress: streetAddress,
                city: city,
                state: state,
                price: parseInt(document.getElementById('dealPrice').value) || 0,
                bedrooms: document.getElementById('dealBedrooms').value,
                bathrooms: document.getElementById('dealBathrooms').value,
                sqft: parseInt(document.getElementById('dealSquareFeet').value) || 0,
                propertyType: document.getElementById('dealPropertyType').value,
                condition: document.getElementById('dealCondition').value
            };

            const matchingContainer = document.getElementById('matchingBuyBoxes');
            if (!matchingContainer) return;

            try {
                // Load buyers from Firebase
                const buyers = await CloudStorage.loadData('Buyers', []);
                const matches = findMatchingBuyers(dealData, buyers);

                if (matches.length === 0) {
                    matchingContainer.innerHTML = `
                        <div class="text-center py-4">
                            <div class="text-gray-500 mb-2">No matching buyers found</div>
                            <div class="text-xs text-gray-400">Try adjusting your property criteria</div>
                        </div>
                    `;
                } else {
                    const matchHtml = matches.map(buyer => `
                        <div class="flex items-center justify-between bg-white p-3 rounded border border-green-200 mb-2">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                <span class="font-medium">${buyer.strategy || 'Investment'}</span>
                                <span class="text-sm text-gray-500">• ${buyer.areas || 'Nationwide'}</span>
                                <span class="text-sm text-gray-500">• $${buyer.minBudget ? parseInt(buyer.minBudget).toLocaleString() : '0'}-${buyer.maxBudget ? parseInt(buyer.maxBudget).toLocaleString() : '∞'}</span>
                            </div>
                            <div class="text-xs text-green-600 font-medium">MATCH</div>
                        </div>
                    `).join('');
                    
                    matchingContainer.innerHTML = `
                        <div class="mb-2 text-sm font-medium text-green-700">${matches.length} matching buyer${matches.length === 1 ? '' : 's'} found:</div>
                        ${matchHtml}
                    `;
                }
            } catch (error) {
                console.error('Error finding matching buyers:', error);
                matchingContainer.innerHTML = '<div class="text-red-500 text-sm">Error finding matches</div>';
            }
        }

        function findMatchingBuyers(dealData, buyers) {
            return buyers.filter(buyer => {
                // Price range check (using dashboard field names)
                if (dealData.price > 0) {
                    if (buyer.minBudget && dealData.price < parseInt(buyer.minBudget)) return false;
                    if (buyer.maxBudget && dealData.price > parseInt(buyer.maxBudget)) return false;
                }

                // Property type check (using dashboard field names)
                if (dealData.propertyType && buyer.propertyTypes) {
                    const buyerTypes = buyer.propertyTypes.toLowerCase();
                    const dealType = dealData.propertyType.toLowerCase();
                    
                    // Map deal types to common variations buyers might use
                    const typeMatches = {
                        'single family': ['sfh', 'single family', 'single-family', 'house'],
                        'condo': ['condo', 'condos', 'condominium'],
                        'townhouse': ['townhouse', 'townhome', 'town house'],
                        'multi-family': ['multi-family', 'multifamily', 'multi family', 'duplex', 'triplex', 'fourplex'],
                        'land': ['land', 'lots', 'vacant'],
                        'commercial': ['commercial', 'retail', 'office', 'warehouse']
                    };
                    
                    const possibleMatches = typeMatches[dealType] || [dealType];
                    const hasMatch = possibleMatches.some(match => buyerTypes.includes(match));
                    
                    if (!hasMatch && !buyerTypes.includes('all') && !buyerTypes.includes('any')) {
                        return false;
                    }
                }

                // Area/location check - now using separate city/state fields
                if (buyer.areas && (dealData.city || dealData.state)) {
                    const buyerAreas = buyer.areas.toLowerCase();

                    // Use separate city and state if available, fallback to parsing address
                    let city, state;
                    if (dealData.city && dealData.state) {
                        city = dealData.city.toLowerCase().trim();
                        state = dealData.state.toLowerCase().trim();
                    } else if (dealData.address) {
                        // Fallback to parsing combined address for older data
                        const addressParts = dealData.address.split(',');
                        if (addressParts.length >= 2) {
                            city = addressParts[addressParts.length - 2].trim().toLowerCase();
                            state = addressParts[addressParts.length - 1].trim().split(' ')[0].toLowerCase();
                        }
                    }

                    if (city && state) {
                        // Check if buyer areas include the city or state
                        if (!buyerAreas.includes(city) && !buyerAreas.includes(state) &&
                            !buyerAreas.includes('nationwide') && !buyerAreas.includes('any')) {
                            return false;
                        }
                    }
                }

                // Bedroom requirement check - only check if buyer has requirement AND deal has bedroom data
                if (buyer.minBedrooms && dealData.bedrooms) {
                    const dealBedrooms = parseInt(dealData.bedrooms);
                    const buyerMinBedrooms = parseInt(buyer.minBedrooms);
                    if (!isNaN(dealBedrooms) && !isNaN(buyerMinBedrooms) && dealBedrooms < buyerMinBedrooms) {
                        return false;
                    }
                }

                // Bathroom requirement check - only check if buyer has requirement AND deal has bathroom data
                if (buyer.minBathrooms && dealData.bathrooms) {
                    const dealBathrooms = parseFloat(dealData.bathrooms);
                    const buyerMinBathrooms = parseFloat(buyer.minBathrooms);
                    if (!isNaN(dealBathrooms) && !isNaN(buyerMinBathrooms) && dealBathrooms < buyerMinBathrooms) {
                        return false;
                    }
                }

                // Square footage requirement check - only check if buyer has requirement AND deal has sqft data
                if (buyer.minSquareFeet && dealData.sqft) {
                    const dealSqft = parseInt(dealData.sqft);
                    const buyerMinSqft = parseInt(buyer.minSquareFeet);
                    if (!isNaN(dealSqft) && !isNaN(buyerMinSqft) && dealSqft < buyerMinSqft) {
                        return false;
                    }
                }

                return true;
            });
        }

        async function handleDealSubmission(form) {
            const submitButton = form.querySelector('button[type="submit"]');
            
            // Show loading state
            const originalText = submitButton.textContent;
            submitButton.innerHTML = '<span class="animate-spin">⏳</span> Submitting Deal...';
            submitButton.disabled = true;

            // Collect form data
            const streetAddress = document.getElementById('dealStreetAddress').value;
            const city = document.getElementById('dealCity').value;
            const state = document.getElementById('dealState').value;

            // Create combined address for compatibility with existing systems
            const fullAddress = [streetAddress, city, state].filter(part => part.trim()).join(', ');

            const dealData = {
                id: Date.now(),
                propertyAddress: fullAddress,
                streetAddress: streetAddress,
                city: city,
                state: state,
                price: document.getElementById('dealPrice').value,
                bedrooms: document.getElementById('dealBedrooms').value,
                bathrooms: document.getElementById('dealBathrooms').value,
                sqft: document.getElementById('dealSquareFeet').value,
                propertyType: document.getElementById('dealPropertyType').value,
                condition: document.getElementById('dealCondition').value,
                arv: document.getElementById('dealARV').value,
                repairCosts: document.getElementById('dealRepairCosts').value,
                contractedPrice: document.getElementById('dealContractedPrice').value,
                closingDate: document.getElementById('dealClosingDate').value,
                description: document.getElementById('dealDescription').value,
                wholesalerName: document.getElementById('wholesalerName').value,
                wholesalerPhone: document.getElementById('wholesalerPhone').value,
                wholesalerEmail: document.getElementById('wholesalerEmail').value,
                dateSubmitted: new Date().toISOString(),
                status: 'pending'
            };

            // Basic validation
            if (!dealData.streetAddress || !dealData.city || !dealData.state || !dealData.price || !dealData.bedrooms || !dealData.bathrooms ||
                !dealData.propertyType || !dealData.condition || !dealData.arv || !dealData.repairCosts ||
                !dealData.contractedPrice || !dealData.closingDate || !dealData.wholesalerName ||
                !dealData.wholesalerPhone || !dealData.wholesalerEmail) {
                EnrichedProps.showErrorMessage('Please fill in all required fields');
                resetSubmitButton();
                return;
            }

            // Validate email
            if (!EnrichedProps.validateEmail(dealData.wholesalerEmail)) {
                EnrichedProps.showErrorMessage('Please enter a valid email address');
                resetSubmitButton();
                return;
            }

            // Validate phone
            if (!EnrichedProps.validatePhone(dealData.wholesalerPhone)) {
                EnrichedProps.showErrorMessage('Please enter a valid 10-digit phone number');
                resetSubmitButton();
                return;
            }

            try {
                console.log('Submitting deal:', dealData);

                // Find matching buyers from Firebase
                const buyers = await CloudStorage.loadData('Buyers', []);
                console.log('Loaded buyers:', buyers.length);

                const matches = findMatchingBuyers(dealData, buyers);
                console.log('Found matches:', matches.length, matches);

                dealData.matchingBuyers = matches.length;
                dealData.matchedBuyerIds = matches.map(b => b.id);
                dealData.matchedBuyerDetails = matches.map(b => ({
                    id: b.id,
                    name: b.name,
                    company: b.company,
                    email: b.email,
                    phone: b.phone,
                    type: b.type,
                    minBudget: b.minBudget,
                    maxBudget: b.maxBudget
                }));

                // Store the deal submission in Firebase
                const existingDeals = await CloudStorage.loadData('WholesaleDeals', []);
                console.log('Existing deals:', existingDeals.length);

                existingDeals.push(dealData);
                await CloudStorage.saveData('WholesaleDeals', existingDeals);

                console.log('Deal saved successfully!');

                // Show success message
                EnrichedProps.showSuccessMessage(`🎉 Deal submitted successfully! ${matches.length} buyer${matches.length === 1 ? '' : 's'} will be notified.`);
                
                // Close modal and reset form
                closeSubmitDealModal();
                resetSubmitButton();

            } catch (error) {
                console.error('Error submitting deal:', error);
                EnrichedProps.showErrorMessage('There was an error submitting your deal. Please try again.');
                resetSubmitButton();
            }

            function resetSubmitButton() {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        }

        // Login Modal Functions (same as main site)
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                setTimeout(() => {
                    const usernameField = document.getElementById('username');
                    if (usernameField) {
                        usernameField.focus();
                    }
                }, 100);
            }
        }

        function hideLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                const form = modal.querySelector('form');
                if (form) {
                    form.reset();
                }
            }
        }

        function login(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const submitButton = event.target.querySelector('button[type="submit"]');
            
            const originalText = submitButton.textContent;
            submitButton.innerHTML = '<span class="spinner"></span>Authenticating...';
            submitButton.disabled = true;
            
            setTimeout(() => {
                if (username === 'admin' && password === 'enriched2024') {
                    localStorage.setItem('enrichedPropsAuth', 'true');
                    localStorage.setItem('enrichedPropsUser', username);
                    
                    EnrichedProps.showSuccessMessage('Login successful! Redirecting to dashboard...');
                    
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1500);
                } else {
                    EnrichedProps.showErrorMessage('Invalid username or password. Try: admin / enriched2024');
                    
                    submitButton.innerHTML = originalText;
                    submitButton.disabled = false;
                }
            }, 1500);
        }
    </script>
</body>
</html>
